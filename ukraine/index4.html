
<!DOCTYPE html><meta charset="utf-8"><style>


</style> <body>

<link rel="stylesheet" type="text/css" href="scripts/style.css"> </link>
<h1>Should Ukraine and Russia unite as one country?</h1>


<script src="scripts/d3.v3.min.js"></script> 
<script src="scripts/topojson.v146.js"></script> 
<script src="scripts/queue.v1.min.js"></script>
<script>

var width = 700,
    height = width/1.5;

var projection = d3.geo.albers()
    .center([0, 50])
    .rotate([-30, 0])
    .parallels([50, 60])
    .scale(width*4.5)
    .translate([width / 2.3, height / 3]);

var path = d3.geo.path()
    .projection(projection);

//mapping variables

var     names = d3.map(),
     pn = d3.map(),
     pn2 = d3.map();

//default filter
var filt="protester"


var quantize = d3.scale.quantize()
    .domain([0,45])
    .range(d3.range(9,17).map(function(i) { return "q" + i + "-9"; }));

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

 var div = d3.select("body").append("div")   
  .attr("class", "tooltip")               
  .style("opacity", 0);




mm = function(l,value ) {
	var p=[""]
    for( var prop in l ) {
             if( l[ prop ] == value )
                 p.push(prop)
    }
     return(p)
}

var rateByI =d3.map(),
    protesterData

var excludeList=["Kherson","Makiivka","Chernihiv","Odessa"]

//load datasets
queue()
    .defer(d3.json, "data/ukraine.json")
    .defer(d3.csv, "data/stats.csv")
    .await(ready);

function ready(error,uk,out1){

    out1.forEach(function(d){
      rateByI.set(d.id,d.score)
      names.set(d.id, d.name)
    })

    //placeData = out2.map(function(d) return  {place:d.originalPlace, lat:d.latitude,lon:d.longitude})


        svg.append("g")
    .selectAll("path")
          .data(topojson.feature(uk, uk.objects.collection).features)
      .enter().append("path")
        .attr("class", function(d) { return quantize(rateByI.get(d.id)); })
        .attr("d", path)
        .style("opacity",1)
            .style("stroke","#444")
              .style("stroke-width","0.8px")
              .style("stroke-dasharray","0.8,3")
        .on("mouseover", function(d) {
            d3.select(this).classed("active", true)
            div.transition().duration(20)
            .style("opacity", 1)
          div.html("Area: "+names.get(d.id)+"<br>Answered yes: "+rateByI.get(d.id)+"%")
          .style("left", (d3.event.pageX) + "px")
          .style("top", (d3.event.pageY -5) + "px")
        })
        .on("mouseout", function() {
          d3.select(this).classed("active", false)
          d3.select(this)
          .transition().duration(20)
          .style("opacity", 1);
          div.transition().duration(20)
          .style("opacity", 0);
        })


  svg.append("path")
      .datum(topojson.mesh(uk, uk.objects.collection, function(a, b) { return a == b; }))
      .attr("d", path)
      .attr("class", "subunit-boundary2")


  d3.csv("data/citiLoc.csv", function(error, data) {

    var city = svg.selectAll("g.city")
          .filter(function(d){return(d.city=+"Beijing")})
    .data(data)
    .enter()
    .append("g")
    .attr("class", "city")
    .attr("transform", function(d) { return "translate(" + projection([d.longitude, d.latitude]) + ")"; })


    city.append("circle")
    .attr("r", function(d){return d.pop/200})
    .style("opacity", 0.75)
    .style("stroke","#333")
    .style("fill","none")

    city.append("text")
    .attr("y",4)
    .attr("x",function(d) {return( excludeList.indexOf(d.city)== -1 ? -d.pop/200 -3 : 
      d.pop/200 +3)})
    .style("font-size","10px")
    .style("font-weight","bold")
    .style("text-anchor",function(d) {return( excludeList.indexOf(d.city)== -1 ? "end" : "start" )})
    .text(function(d) { return d.city; });
  });

}

  var color_domain = [6,12,18,24,30,36,42]
  var ext_color_domain = [0,6,12,18,24,30,36,42]
  var legend_labels = ["0-6%", "6%","12%","18%","24%","30%","36%","40%+"  ] 
  var color = d3.scale.threshold()
  .domain(color_domain)
  .range(["#f7fbff", "#deebf7", "#c6dbef", "#9ecae1", "#6baed6", "#4292c6", "#2171b5", "#084594"]);

  var legend = svg.selectAll("g.legend")
  .data(ext_color_domain)
  .enter().append("g")
  .attr("class", "legend");

  var ls_w = 20, ls_h = 20;

  legend.append("rect")
  .attr("x", 20)
  .attr("y", function(d, i){ return height - (i*ls_h) - 2*ls_h;})
  .attr("width", ls_w)
  .attr("height", ls_h)
  .style("fill", function(d, i) { return color(d); })
  .style("opacity", 0.8);

  legend.append("text")
  .attr("x", 50)
  .attr("y", function(d, i){ return height - (i*ls_h) - ls_h - 4;})
  .text(function(d, i){ return legend_labels[i]; });

function trans(word){
  var answer = ""
    , a = {};

   a["Ё"]="Yo";a["Й"]="I";a["Ц"]="Ts";a["У"]="U";a["К"]="K";a["Е"]="E";a["Н"]="N";a["Г"]="G";a["Ш"]="Sh";a["Щ"]="Shch";a["З"]="Z";a["Х"]="Kh";a["Ъ"]="'";
   a["ё"]="yo";a["й"]="i";a["ц"]="ts";a["у"]="u";a["к"]="k";a["е"]="e";a["н"]="n";a["г"]="g";a["ш"]="sh";a["щ"]="shch";a["з"]="z";a["х"]="kh";a["ъ"]="'";
   a["Ф"]="F";a["Ы"]="Y";a["В"]="V";a["А"]="A";a["П"]="P";a["Р"]="R";a["О"]="O";a["Л"]="L";a["Д"]="D";a["Ж"]="Zh";a["Э"]="E";
   a["ф"]="f";a["ы"]="y";a["в"]="v";a["а"]="a";a["п"]="p";a["р"]="r";a["о"]="o";a["л"]="l";a["д"]="d";a["ж"]="zh";a["э"]="e";
   a["Я"]="Ya";a["Ч"]="Ch";a["С"]="S";a["М"]="M";a["И"]="I";a["Т"]="T";a["Ь"]="'";a["Б"]="B";a["Ю"]="Yu";
   a["я"]="ia";a["ч"]="ch";a["с"]="s";a["м"]="m";a["и"]="i";a["т"]="t";a["ь"]="'";a["б"]="b";a["ю"]="iu";a["є"]="e";a["Є"]="Ye";a["і"]="i";a["Ї"]="Yi";

   for (i in word){
   if (word.hasOwnProperty(i)) {
     if (a[word[i]] === undefined){
     answer += word[i];
     } else {
     answer += a[word[i]];
     }
   }
   }
   return answer;
}




</script> 


